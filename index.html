<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0a0c10" />
  <title>AR мощение тротуарной плитки — Web</title>
  <link rel="icon" href="./favicon.ico" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.webmanifest" />
</head>
<body>
  <canvas id="c"></canvas>

  <!-- Splash (каждый запуск) -->
  <div id="splash" class="splash" aria-hidden="false">
    <div class="splashCard">
      <img class="splashLogo" src="./assets/logo.png" alt="Логотип" />
      <div id="splashText" class="splashText">Загрузка…</div>
      <div id="splashSub" class="splashSub">Проверяем AR и подготавливаем материалы</div>
      <div class="splashBar"><div id="splashBar" class="splashBarFill"></div></div>
    </div>
  </div>

  <header class="topbar">
    <div class="title">AR мощение <span class="ver">Web</span></div>
    <div id="status" class="status">инициализация…</div>
  </header>

  <section id="help" class="card help" role="dialog" aria-label="Подсказки" hidden>
    <div class="cardHead">
      <div class="cardTitle">Контур: как пользоваться</div>
      <button id="closeHelp" class="iconBtn" aria-label="Скрыть подсказки">×</button>
    </div>
    <ol class="helpList">
      <li>Откройте сайт в <b>Chrome на Android</b> (нужен ARCore).</li>
      <li>Нажмите <b>Включить AR</b> и наведите камеру на пол.</li>
      <li>Нажмите <b>Калибр. пол</b>, когда маркер точно на полу.</li>
      <li>Тапайте по углам области — ставятся точки контура.</li>
      <li>Замкните контур: поставьте последнюю точку рядом с первой.</li>
      <li>Нажмите <b>Визуализировать</b> → плитка заполнит контур.</li>
    </ol>
    <div class="helpNote">
      Админка каталога: <a href="./admin.html" target="_blank" rel="noopener">admin.html</a>
    </div>
  </section>

  <button id="menuFab" class="fab" aria-label="Открыть меню" title="Меню">☰</button>
  <button id="catalogFab" class="fab fab2" aria-label="Каталог" title="Каталог">▦</button>
  <button id="helpFab" class="fab fab3" aria-label="Подсказки" title="Подсказки">?</button>

  <section id="panel" class="panel">
    <div class="panelGrip" aria-hidden="true"></div>

    <div class="panelRow">
      <button id="enterArBtn" class="btn primary">Включить AR</button>
      <button id="exitArBtn" class="btn" disabled>Выход</button>
      <button id="clearBtn" class="btn">Очистить</button>
      <button id="hidePanelBtn" class="btn ghost">Скрыть</button>
    </div>

    <div class="card compact">
      <div class="cardTitle">Трекинг пола</div>
      <div class="panelRow small">
        <button id="calibrateBtn" class="btn primary">Калибр. пол</button>
        <button id="recalibrateBtn" class="btn">Перекалибр.</button>
        <label class="chk">
          <input id="gridToggle" type="checkbox" checked />
          <span>Сетка</span>
        </label>
      </div>
      <div class="note" id="calibHint">Сначала наведите маркер на пол и нажмите «Калибр. пол».</div>
    </div>

    <div class="card compact">
      <div class="cardTitle">Контур</div>
      <div class="note" id="drawStatus">Нажмите «Калибр. пол», затем ставьте точки.</div>
      <div class="panelRow small">
        <button id="undoBtn" class="btn">↶ Отмена</button>
        <button id="resetPolyBtn" class="btn">Сброс</button>
      </div>
      <div class="note" id="areaOut">—</div>
    </div>

    <div class="card compact">
      <div class="cardTitle">Плитка</div>
      <div class="note"><b id="tileName">—</b></div>
      <div id="variantRow" class="variantRow"></div>
      <label class="field">
        <span>Масштаб текстуры: <b id="texVal">1.00</b>x</span>
        <input id="texScale" type="range" min="0.25" max="3" step="0.05" value="1.00" />
      </label>
      <label class="field">
        <span>Раскладка</span>
        <select id="layout">
          <option value="straight">Прямая</option>
          <option value="diagonal">Диагональ 45°</option>
          <option value="cross">Поворот 90°</option>
          <option value="running">Смещение рядов</option>
        </select>
      </label>
      <div class="panelRow small">
        <button id="openCatalogBtn" class="btn">Открыть каталог</button>
      </div>
    </div>

    <div class="note small muted">
      Важно: после «Перекалибр.» контур сбрасывается.
    </div>
  </section>

  <!-- Bottom CTA (не закрывает обзор) -->
  <div id="cta" class="cta" hidden>
    <button id="visualizeBtn" class="btn primary">Визуализировать</button>
    <button id="shotBtn" class="btn">Скриншот</button>
  </div>

  <div id="catalogOverlay" class="catalogOverlay hidden" aria-hidden="true">
    <div class="catalogModal">
      <div class="catalogHead">
        <div class="catalogTitle">Каталог плитки</div>
        <button id="closeCatalogBtn" class="iconBtn" aria-label="Закрыть каталог">×</button>
      </div>

      <div class="catalogControls">
        <input id="catalogSearch" class="search" type="search" placeholder="Поиск по названию…" />
        <div class="filters">
          <select id="filterCollection"><option value="">Коллекция (все)</option></select>
          <select id="filterTech"><option value="">Технология (все)</option></select>
          <select id="filterThickness"><option value="">Толщина (все)</option></select>
        </div>
        <div class="catalogHint">Нажмите на карточку, чтобы применить плитку.</div>
      </div>

      <div id="catalogGrid" class="catalogGrid"></div>
    </div>
  </div>

  <pre id="dbg" class="dbg" hidden></pre>

  <script type="module" src="app.js"></script>
</body>
</html>
